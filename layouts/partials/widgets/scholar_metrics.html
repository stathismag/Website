{{/* Google Scholar Metrics Widget - Matches existing site styling */}}
{{ $page := .page }}

<div class="row">
  <div class="col-lg-12">
    <div style="background-color: #ffffff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; max-width: 400px; margin: 20px auto; font-family: Arial, sans-serif;">
      <h4 style="color: #4285F4; text-align: center; margin: 0 0 10px 0; font-size: 18px; font-weight: normal;">Google Scholar Metrics</h4>
      <div style="display: flex; justify-content: space-between; text-align: center;">
        <div>
          <p style="font-size: 24px; font-weight: bold; margin: 0; color: #333;" id="citations-value">{{ .Params.citations | default "..." }}</p>
          <p style="margin: 0; color: #666; font-size: 12px;">Citations</p>
        </div>
        <div>
          <p style="font-size: 24px; font-weight: bold; margin: 0; color: #333;" id="h-index-value">{{ .Params.h_index | default "..." }}</p>
          <p style="margin: 0; color: #666; font-size: 12px;">H-Index</p>
        </div>
        <div>
          <p style="font-size: 24px; font-weight: bold; margin: 0; color: #333;" id="i10-index-value">{{ .Params.i10_index | default "..." }}</p>
          <p style="margin: 0; color: #666; font-size: 12px;">i10-Index</p>
        </div>
      </div>
      <p style="text-align: center; margin: 10px 0 0 0; font-size: 11px; color: #999;">
        <a href="https://scholar.google.com/citations?user=LxLY15EAAAAJ&hl" target="_blank" rel="noopener" style="color: #4285F4; text-decoration: none;">View Profile</a>
        <span style="margin: 0 5px;">â€¢</span>
        <span id="last-updated">Auto-updated daily</span>
      </p>
    </div>
  </div>
</div>

<script>
// Auto-refresh metrics from JSON data
(function() {
  async function updateMetrics() {
    try {
      const response = await fetch('/data/google_scholar_citations.json');
      if (response.ok) {
        const data = await response.json();

        const citationsEl = document.getElementById('citations-value');
        const hIndexEl = document.getElementById('h-index-value');
        const i10IndexEl = document.getElementById('i10-index-value');
        const updateTimeEl = document.getElementById('last-updated');

        if (citationsEl && data.total_citations) {
          citationsEl.textContent = data.total_citations;
        }

        if (hIndexEl && data.h_index) {
          hIndexEl.textContent = data.h_index;
        }

        if (i10IndexEl && data.i10_index) {
          i10IndexEl.textContent = data.i10_index;
        }

        if (updateTimeEl && data.last_updated) {
          const date = new Date(data.last_updated);
          updateTimeEl.textContent = 'Updated ' + date.toLocaleDateString('en-US', {
            month: 'short',
            day: 'numeric'
          });
        }
      }
    } catch (error) {
      console.log('Using static metrics');
    }
  }

  // Update metrics on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updateMetrics);
  } else {
    updateMetrics();
  }
})();
</script>
